define(["require","exports","tslib","react","modules/core/i18n","spectrum/button","spectrum/modal","spectrum/input","modules/clean/teams/admin/widgets/import_contacts_modal/contact_row","dig-components/typography","modules/clean/react/css","modules/clean/api_v2/user_client","modules/clean/viewer","dig-components/progress_indicators","modules/clean/profile_services/profile_services_constants","modules/clean/contacts/contact","modules/clean/analytics"],(function(e,t,a,n,o,l,s,r,c,i,m,u,d,f,_,g,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a.__importStar(n),_=a.__importDefault(_);var v=o.intl.formatMessage({id:"IFzVqk",defaultMessage:"Invite through Google directory"}),h=o.intl.formatMessage({id:"qx0cgi",defaultMessage:"Back"}),y=o.intl.formatMessage({id:"I+vIeJ",defaultMessage:"Select all"}),E=o.intl.formatMessage({id:"+t/Zhg",defaultMessage:"Deselect all"}),M=o.intl.formatMessage({id:"WElJu0",defaultMessage:"Search"}),N=o.intl.formatMessage({id:"NL/j2z",defaultMessage:"Select"}),b=o.intl.formatMessage({id:"yofFQe",defaultMessage:"Loading imported contactsâ€¦"}),w=o.intl.formatMessage({id:"Y8H16v",defaultMessage:"No matching results"}),S=o.intl.formatMessage({id:"3ass6r",defaultMessage:"Try something different"}),C=o.intl.formatMessage({id:"i5tU+X",defaultMessage:"No contacts found in your Google Directory."}),x=o.intl.formatMessage({id:"B+euqn",defaultMessage:"Something went wrong."}),L=o.intl.formatMessage({id:"lhVDhj",defaultMessage:"Try again in a few moments."});t.ImportContactsModal=m.requireCssWithComponent((function(e){var t=n.useState(!0),o=t[0],m=t[1],T=n.useState(!1),k=T[0],A=T[1],I=n.useState(""),W=I[0],q=I[1],D=n.useState([]),F=D[0],U=D[1],j=n.useState([]),B=j[0],G=j[1],O=n.useState([]),V=O[0],z=O[1],R=n.useState(new Map),J=R[0],P=R[1],H=(function(e,t){var a=n.useState(e),o=a[0],l=a[1];return n.useEffect((function(){var a=setTimeout((function(){l(e)}),t);return function(){clearTimeout(a)}}),[e,t]),o})(W,300);n.useEffect((function(){me(),p.TeamsWebActionsLogger.log("google_directory_import_modal_shown")}),[]),n.useEffect((function(){k||ce(H)}),[H,o,k]);var Q=a.__spreadArrays(F,B),X=Q.map((function(e){return e.email})),Y=V.sort((function(e,t){return e.displayName.localeCompare(t.displayName)})),Z=Y.filter((function(e){return c.isInvitable(e)})),K=Z.filter((function(e){return e.isSelected})),$=e.preselectedContacts.map((function(e){return e.email})),ee=F.filter((function(e){return e.isSelected})),te=K.length===Z.length,ae=0===Q.length,ne=!ae&&0===V.length,oe=function(){var t=ee.map((function(e){return g.Contact.buildFromRawEmail(e.email)})),a=e.preselectedContacts.filter((function(e){return e.email&&!X.includes(e.email)}));e.onConfirmSelection(t,a)},le=n.useMemo((function(){return n.default.createElement(l.Button,{className:"import-contacts-modal__confirm-select",variant:"primary",disabled:o||0===ee.length,onClick:oe},n.default.createElement("span",{className:"modal-button-wrapper"},N))}),[ee,o]),se=function(t){e.onClose()},re=n.useMemo((function(){return n.default.createElement(l.Button,{className:"import-contacts-modal__go-back",variant:"secondary",onClick:se},n.default.createElement("span",{className:"modal-button-wrapper"},h))}),[]),ce=function(e){if(e){for(var t=e.toLocaleLowerCase(),a=[],n=0,o=Array.from(J.keys());n<o.length;n++){var l=o[n];l.includes(t)&&a.push(J.get(l))}z(a)}else z(Q)},ie=function(e){var t=e.isSelected?"google_directory_import_modal_deselect_contact":"google_directory_import_modal_select_contact";p.TeamsWebActionsLogger.log(t),U((function(t){var n=a.__spreadArrays(t);return n.includes(e)&&(e.isSelected=!e.isSelected),n}))},me=function(){return a.__awaiter(void 0,void 0,void 0,(function(){var e,t,n,o,l,s,r;return a.__generator(this,(function(a){switch(a.label){case 0:e=d.Viewer.get_viewer(),t=(new u.UserApiV2Client).ns("domain_contacts"),n={contacts:[]},a.label=1;case 1:return a.trys.push([1,3,,4]),[4,t.rpc("list",{service:_.default.to_api_service_type(_.default.GOOGLE)},{subjectUserId:e.work_user.id})];case 2:return n=a.sent(),[3,4];case 3:return a.sent(),A(!0),m(!1),p.TeamsWebActionsLogger.log("google_directory_import_modal_error_state"),[2];case 4:return o=n.contacts.filter((function(t){return t.email!==e.work_user.email})).map((function(e){return{email:e.email,displayName:e.display_name,teamStatus:e.team_status,isSelected:!1}})),l=o.filter((function(e){return c.isInvitable(e)})),s=o.filter((function(e){return!c.isInvitable(e)})),l.forEach((function(e){e.isSelected=-1!==$.indexOf(e.email)})),s.forEach((function(e){e.isSelected=!0})),r=new Map,o.forEach((function(e){var t=(e.displayName+" "+e.email).toLocaleLowerCase();r.set(t,e)})),U(l),G(s),P(r),p.TeamsWebActionsLogger.log("google_directory_import_modal_contacts_loaded",{num_invitable_contacts:l.length,num_uninvitable_contacts:s.length}),m(!1),[2]}}))}))},ue={tagName:"p",color:"faint",size:"small"};return n.default.createElement(s.UtilityModal,{title:v,open:!0,ariaLabel:v,primaryAction:function(){return le},secondaryAction:function(){return re},className:"import-contacts-modal",width:e.width+"px",onRequestClose:e.onClose},n.default.createElement(n.default.Fragment,null,n.default.createElement(r.Input,{className:"import-contacts-modal__search",placeholder:M,value:W,"aria-label":M,fullWidth:!0,onChange:function(e){return q(e.target.value)}}),o?n.default.createElement("div",{className:"import-contacts-modal__container"},n.default.createElement(f.Spinner,{"aria-valuetext":b})):k?n.default.createElement("div",{className:"import-contacts-modal__container"},n.default.createElement(i.Text,a.__assign({},ue,{className:"import-contacts-modal__small-text"}),x),n.default.createElement(i.Text,a.__assign({},ue,{className:"import-contacts-modal__small-text"}),L)):ae?n.default.createElement("div",{className:"import-contacts-modal__container"},n.default.createElement(i.Text,a.__assign({},ue),C)):ne?n.default.createElement("div",{className:"import-contacts-modal__container"},n.default.createElement(i.Text,a.__assign({},ue,{className:"import-contacts-modal__small-text"}),w),n.default.createElement(i.Text,a.__assign({},ue,{className:"import-contacts-modal__small-text"}),S)):n.default.createElement(n.default.Fragment,null,n.default.createElement("div",{className:"import-contacts-modal__select-controls"},n.default.createElement("div",{className:"import-contacts-modal__num-selected"},ee.length+" selected"),n.default.createElement(i.Link,{href:"",onClick:function(e){e.preventDefault(),e.stopPropagation();var t=te?K.length:Z.length-K.length,n=te?"google_directory_import_modal_deselect_all":"google_directory_import_modal_select_all";p.TeamsWebActionsLogger.log(n,{num_contacts_toggled:t,total_invitable_contacts:F.length,search_term_present:""!==W}),z((function(e){return(function(e,t){var n=a.__spreadArrays(e);return n.forEach((function(e){c.isInvitable(e)&&(e.isSelected=!t)})),n})(e,te)}))},hasNoUnderline:!0,className:"import-contacts-modal__"+(te?"deselect-all":"select-all")},te?E:y)),n.default.createElement("hr",{className:"import-contacts-modal__divider"}),n.default.createElement("div",{className:"import-contacts-modal__contacts"},Y.map((function(e){return n.default.createElement(c.ContactRow,{key:e.email,contact:e,onCheck:ie})}))))))}),["/static/css/teams/admin/widgets/import_contacts_modal/import_contacts_modal-vfl3i_RDR.css"])}));
//# sourceMappingURL=import_contacts_modal.min.js-vflxjXLLx.map